-#
  # $HeadURL$
  # $Id$
  #
  # Copyright (c) 2009-2010 by Public Library of Science, a non-profit corporation
  # http://www.plos.org/
  #
  # Licensed under the Apache License, Version 2.0 (the "License");
  # you may not use this file except in compliance with the License.
  # You may obtain a copy of the License at
  #
  #     http://www.apache.org/licenses/LICENSE-2.0
  #
  # Unless required by applicable law or agreed to in writing, software
  # distributed under the License is distributed on an "AS IS" BASIS,
  # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  # See the License for the specific language governing permissions and
  # limitations under the License.
!!! 5
%html{ :lang => "en" }
  %head
    /
      = SOURCE_REVISION
    %meta{ :charset => "utf-8" }
    %title
      = "(#{Rails.env}) " unless Rails.env.production?
      = APP_CONFIG['application']
    %link{ :type => "image/x-icon", :href => "/favicon.ico", :rel => "shortcut icon" }
    = stylesheet_link_tag 'application'
    = javascript_include_tag :defaults
    = csrf_meta_tag
    = yield(:head)
    :javascript
      $(function() {
        $('#content .inner .flash').delay(2500).slideUp();
      });
%body{ :class => "#{params[:controller]} #{params[:controller]}-#{params[:action]}" }
  %header
    .inner
      %h1= APP_CONFIG['application']
      %div.slogan= APP_CONFIG['slogan']
      - if ["articles", "authors"].include?(controller.controller_name) and ["index", "search"].include?(controller.action_name)
        = form_tag({:controller => controller.controller_name, :action => "index"}, :method => "get", :class => "inline") do
          %span.search Search
          = text_field_tag :q, params[:q]
          = observe_field 'q', :frequency => 0.5, :update => 'index', :url => { :controller => controller.controller_name, :action => :index }, :method => :get, :with => "'q=' + encodeURIComponent(value)"
    %nav
      .inner
        %ul.nav       
          %li= link_to "Authors", authors_path, :class => current_page?(authors_path) ? 'current' : ''
          %li= link_to "Articles", articles_path, :class => current_page?(articles_path) ? 'current' : ''
          %li= link_to "About", about_path, :class => current_page?(about_path) ? 'current' : '' 
          - if current_author.try(:admin?)  
            %li= link_to "Sources", sources_path, :class => current_page?(sources_path) ? 'current' : ''
            %li= link_to "Groups", groups_path, :class => current_page?(groups_path) ? 'current' : ''
          %li.login
            - if author_signed_in?
              = link_to "Signed in as " + current_author.display_name, current_author.username
              |
              = link_to "Sign out", destroy_author_session_path, :method => :delete
            - else
              = link_to "Sign in with Twitter", author_omniauth_authorize_path(:twitter)
  #content
    .inner
      - [ :error, :notice, :warning, :message ].each do |name|
        - if flash[name]
          .flash{ :id => name, :class => name }
            %span= flash[name]
      %div
        = yield

  /
    = (File.read("REVISION") rescue "development").strip
