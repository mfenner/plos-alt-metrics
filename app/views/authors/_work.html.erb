<%#
  # Copyright (c) 2011 Martin Fenner
  # Licensed under the Apache License, Version 2.0 (the "License");
  # you may not use this file except in compliance with the License.
  # You may obtain a copy of the License at
  #
  #     http://www.apache.org/licenses/LICENSE-2.0
  #
  # Unless required by applicable law or agreed to in writing, software
  # distributed under the License is distributed on an "AS IS" BASIS,
  # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  # See the License for the specific language governing permissions and
  # limitations under the License.
-%>

<% unless @author.works.empty? %>
	<div class="work">
		<table class="zebra-striped">
		  <thead>
			<th>
				<h2><%= pluralize(@author.works.count, 'Work') %></h2>
			</th>
			<% active_categories.each do |category| %>
		    <% category.sources.active.each do |source| %>
		      <th>
				    <%= image_tag source.class.to_s.downcase + "_sm.gif", :title => source.category.work_description + ": " + source.name %>
			    </th>
			  <% end %>
	    <% end %>
			</thead>
			<tbody>
	    <% @works.each do |work| %>
	      <tr>
	      	<td>	
	      	  <span itemprop="name" class="name"><%= link_to work.title, work_path(work.id) %></span><br/>
	          <%= formatted_citation(work).html_safe %>
	          <% if !work.content_type.blank? and work.content_type != "journal_work" %>
	            <span class="content_type"><%= work.content_type.sub!(/_/, ' ') ? work.content_type.capitalize : work.content_type.capitalize %></span>
	          <% end %>
	          <br/><%= link_to "http://doi.org/" + work.short_doi, "http://doi.org/" + work.short_doi, :itemprop => "url" %>
	      	</td>
	          <% active_categories.each do |category| %>
					    <% category.sources.active.each do |source| %>
				        <td>
					        <% citation = work.citations_by_source(source) %>
								  <% if citation and citation[:total] > 0 %>
	                 <% if citation[:public_url] %>
	                   <%= link_to h(citation[:total]), citation[:public_url]  %>
	                 <% else %>
	                   <%= h(citation[:total]) %>
	                 <% end %>
	               <% end %>
					    </td>
				    <% end %>
	   	  <% end %>
		  </tr>
	    <% end %>
		</tbody>
		</table>
		<%= will_paginate @works %>
	</div>
<% else %>
  <div class="alert-message warning fade in" data-alert="alert" >
    <a class="close" href="#">&times;</a>
    <p>No works found.</p>
  </div>
<% end %>